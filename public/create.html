<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="/public/css/materialize.min.css"  media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="/public/css/materialize.clockpicker.css"  media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="/public/css/style.css"  media="screen,projection"/>
    <!--<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>-->
    <script type="text/javascript" src="/public/js/jquery-3.2.0.min.js"></script>
    <!--<script type="text/javascript" src="/public/js/knockout.min.js"></script>-->
    <script type="text/javascript" src="/public/js/materialize.min.js"></script>
    <script type="text/javascript" src="/public/js/materialize.clockpicker.js"></script>
    <script type="text/javascript" src="/public/js/jquery.materialize-autocomplete.min.js"></script>
    <script type="text/javascript">

        $(function(){
            $('.datepicker').pickadate({
                selectMonths: true,
                selectYears: 15
            });
            $('#timepicker').pickatime({
                autoclose: false,
                twelvehour: false,
                default: '14:20:00'
            });
            $('select').material_select();
            var single = $('#singleInput').materialize_autocomplete({
                multiple: {
                    enable: false
                },
                dropdown: {
                    el: '#singleDropdown'
                },
                getData: function (value, cb) {

                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        contentType: 'application/json',
                        url: "/users?name=%s",
                        data: {
                            name: value
                        },
                        success: function (data) {

                            selectedData = undefined;

                            cb(value,data);
                        }

                    });
                },
                onSelect: function (item) {

                    selectedData = item;

                }
            });

        })

        var selectedData = undefined;

        var players = [];
        var invites = [];
        var requests = [];

        function showUserInfo() {
            window.open('/users/1','_blank');
        }

        function removeFromPlayers(element) {

            var parent = $(element).closest("li");

            changeClass(parent,"red", "green");

            players = removeFrom(players,parseInt(parent.attr("data-userid")));

            $("#participants").val(JSON.stringify(players));

        }

        function removeFromInvites(element) {

            var parent = $(element).closest("li");

            changeClass(parent,"red", "green");

            invites = removeFrom(invites,parseInt(parent.attr("data-userid")));

            $("#invites").val(JSON.stringify(invites));

        }

        function removeFromRequests(element) {

            var parent = $(element).closest("li");

            changeClass(parent,"red", "green");

            requests = removeFrom(requests,parseInt(parent.attr("data-userid")));

            $("#requests").val(JSON.stringify(requests));

        }

        function addFromRequests(element) {

            var parent = $(element).closest("li");

            changeClass(parent,"green", "red");

            requests = addTo(requests,parseInt(parent.attr("data-userid")));

            $("#requests").val(JSON.stringify(requests));

        }

        function changeClass(parent, newCssClass, oldCssClass) {

            parent.removeClass(oldCssClass);

            if (parent.hasClass(newCssClass)){
                parent.removeClass(newCssClass);
            } else {
                parent.addClass(newCssClass);
            }
        }

        function removeFrom(array, element) {

            var index = array.indexOf(element);

            if (index > -1) {
                array.splice(index,1);
            }

            return array;
        }

        function addTo(array, element) {

            if ($.inArray(element,array) == -1) {
                array.push(element);
            }

            return array;
        }
        
        function invite() {

            if (selectedData != undefined) {

                var length = invites.length;

                invites = addTo(invites, selectedData.id);

                $("#invites").val(JSON.stringify(invites));

                if (length != invites.length) {
                    addToCollection(selectedData.text.split("(")[0],selectedData.id);
                }

                $('#singleInput').get(0).value = "";
                selectedData = undefined;
            }
        }

        function addToCollection(name, id) {

            var str = getHTMLString(name, id);

            $("#invitesCollection").get(0).innerHTML += str;
        }

        function getHTMLString(userName, userId) {

            var str = "<li class='collection-item avatar hoverable' data-userid='"+userId+"'>";
            str += "<img src='https://avatars.githubusercontent.com/u/17765383?v=3&s=40' alt='' class='circle'>";
            str += "<span class='title black-text'>"+userName+"</span>";
            str += "<div class='secondary-content'>";
            str += "<i class='material-icons' onclick='removeFromInvites(this)'>remove</i>";
            str += "<i class='material-icons' onclick='showUserInfo()'>info</i>";
            str += "</div></li>"

            return str;
        }

        
    </script>
    <title>Create Game</title>
</head>
<body>
    <!-- Dropdown Structure -->
    <ul id='dropdown1' class='dropdown-content'>
        <li><a href="/users/1">Profile</a></li>
        <li class="divider"></li>
        <li><a href="/logout">Log out</a></li>
    </ul>

    <nav>
        <div class="nav-wrapper">
            <a href="/" class="brand-logo" style="margin-left: 100px">Find My Team</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down valign-wrapper" style="margin-right: 100px">
                <li><a href="/games/new">Create game</a></li>
                <li><a href="/games">Search game</a></li>
                <li><a href="#!" class="dropdown-button" data-activates="dropdown1"><img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle responsive-img valign"></a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <form class="col s12" method="post" action="/games/new" id="createForm">
                <input id="participants" type="hidden" name="players" value="[]"/>
                <input id="invites" type="hidden" name="invites" value="[]"/>
                <input id="requests" type="hidden" name="requests" value="[]"/>
                <div class="row">
                    <div class="input-field col s2">
                        <select name="sport">
                            <option value="" disabled selected>Choose sport</option>
                            <option value="1">Football</option>
                            <option value="2">Floorball</option>
                        </select>
                        <label>Sport</label>
                    </div>
                    <div class="input-field col s2">
                        <label for="date">Date</label>
                        <input id="date" type="date" class="datepicker" name="date"/>
                    </div>
                    <div class="input-field col s2">
                        <label for="timepicker">Time</label>
                        <input id="timepicker" class="timepicker" type="time" name="type">
                    </div>
                    <div class="input-field col s2">
                        <select name="visibility">
                            <option value="" disabled selected>Choose visibility</option>
                            <option value="1">Private</option>
                            <option value="2">Public</option>
                        </select>
                        <label>Type</label>
                    </div>
                    <div class="input-field col s1">
                        <input id="players" type="text" class="validate" name="playercount">
                        <label for="players">Players</label>
                    </div>
                    <div class="input-field col s2">
                        <select name="level">
                            <option value="" disabled selected>Choose level</option>
                            <option value="1">Proffesional</option>
                            <option value="2">Beginner</option>
                        </select>
                        <label>Level</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="location" type="text" class="validate" name="location">
                        <label for="location">Location</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <div class="row">
                            <div class="input-field col s12">
                                <textarea id="description" class="materialize-textarea" name="description"></textarea>
                                <label for="description">Description</label>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="row">
            <div class="input-field col s5">
                <div class="autocomplete" id="single">
                    <div class="ac-input">
                        <input type="text" id="singleInput"  placeholder="Please input e-mail or username" data-activates="singleDropdown" data-beloworigin="true" autocomplete="off">
                    </div>
                    <ul id="singleDropdown" class="dropdown-content ac-dropdown"></ul>
                </div>
                <label class="active" for="singleInput">Invite player</label>
            </div>
            <div class="col s2">
                <button class="btn waves-effect waves-light input-field" type="button" onclick="invite()" style="float: right">Invite
                    <i class="material-icons right">add</i>
                </button>
            </div>
        </div>
            <div class="row">
                <div class="col s4">
                    <ul class="collection with-header">
                        <li class="collection-header"><h5>Players (3)</h5></li>
                        <li class="collection-item avatar hoverable" data-userid="1">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title black-text">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="removeFromPlayers(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                        <li class="collection-item avatar hoverable" data-userid="2">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title black-text">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="removeFromPlayers(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                        <li class="collection-item avatar hoverable" data-userid="2">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title black-text">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="removeFromPlayers(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="col s4">
                    <ul id="invitesCollection" class="collection with-header">
                        <li class="collection-header"><h5>Invited players (3)</h5></li>
                        <li class="collection-item avatar hoverable" data-userid="3">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title black-text">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="removeFromInvites(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                        <li class="collection-item avatar hoverable" data-userid="2">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title black-text">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="removeFromInvites(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                        <li class="collection-item avatar hoverable" data-userid="4">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title black-text">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="removeFromInvites(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="col s4">
                    <ul class="collection with-header">
                        <li class="collection-header"><h5>Player requests (3)</h5></li>
                        <li class="collection-item avatar hoverable" data-userid="1">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="addFromRequests(this)">add</i>
                                <i class="material-icons" onclick="removeFromRequests(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                        <li class="collection-item avatar hoverable" data-userid="2">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="addFromRequests(this)">add</i>
                                <i class="material-icons" onclick="removeFromRequests(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                        <li class="collection-item avatar hoverable" data-userid="3">
                            <img src="https://avatars.githubusercontent.com/u/17765383?v=3&s=40" alt="" class="circle">
                            <span class="title">Rési Tamás</span>
                            <div class="secondary-content">
                                <i class="material-icons" onclick="addFromRequests(this)">add</i>
                                <i class="material-icons" onclick="removeFromRequests(this)">remove</i>
                                <i class="material-icons" onclick="showUserInfo()">info</i>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row">
                <button class="btn waves-effect waves-light input-field" type="submit" name="action" form="createForm">Create
                    <i class="material-icons right">send</i>
                </button>
                <form action="/games/delete" method="post" class="right">
                    <input type="hidden" name="id" value="1"/>
                    <button class="btn waves-effect waves-light red input-field" type="submit" name="action">Delete
                        <i class="material-icons right">delete</i>
                    </button>
                </form>
            </div>
        </div>
</body>
</html>